<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>私有化部署Git代码服务 | HAI</title>
<link rel="shortcut icon" href="https://besthai.github.io/favicon.ico?v=1583650228340">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://besthai.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="私有化部署Git代码服务 | HAI - Atom Feed" href="https://besthai.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="〇、简介


可以提供的服务：


高效地管理代码


GitHub风格


git远程连接






该系统的组成 :


Gitlab（代码管理）：https://about.gitlab.com/


Poste.io（邮件服务）：..." />
    <meta name="keywords" content="开发工具" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://besthai.github.io">
  <img class="avatar" src="https://besthai.github.io/images/avatar.png?v=1583650228340" alt="">
  </a>
  <h1 class="site-title">
    HAI
  </h1>
  <p class="site-description">
    浮云游子意 · 落日故人情
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/bestHAI" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
    
      
    
      
    
      
        <a href="https://facebook.com/liuhaifeng15" target="_blank">
          <i class="ri-facebook-line"></i>
        </a>
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              私有化部署Git代码服务
            </h2>
            <div class="post-info">
              <span>
                2019-03-15
              </span>
              <span>
                5 min read
              </span>
              
                <a href="https://besthai.github.io/tag/dev_tools/" class="post-tag">
                  # 开发工具
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://besthai.github.io/post-images/code_manager.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h2 id="〇-简介">〇、简介</h2>
<ul>
<li>
<p>可以提供的服务：</p>
<ul>
<li>
<p>高效地管理代码</p>
</li>
<li>
<p>GitHub风格</p>
</li>
<li>
<p>git远程连接</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>该系统的组成 :</p>
<ul>
<li>
<p>Gitlab（代码管理）：<a href="https://about.gitlab.com/">https://about.gitlab.com/</a></p>
</li>
<li>
<p>Poste.io（邮件服务）：<a href="https://www.poste.io/">https://www.poste.io/</a></p>
</li>
<li>
<p>Nginx（反向代理）：<a href="http://nginx.org/">http://nginx.org/</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="一-部署要求">一、部署要求</h2>
<ul>
<li>
<p><strong>CPU两核，内存4G以上</strong></p>
</li>
<li>
<p>如何查看 Linux 硬件状况：</p>
<ul>
<li>
<p>查看CPU状况：<code>cat /proc/cpuinfo</code></p>
</li>
<li>
<p>查看内存状况：<code>cat /proc/meminfo</code> 或者 <code>free -h</code></p>
</li>
</ul>
</li>
<li>
<p>最直观的方法（需要安装 <code>htop</code>）：</p>
<ul>
<li>
<p>Ubuntu系统：<code>apt-get install -y htop</code></p>
</li>
<li>
<p>Centos系统：<code>yum install -y htop</code></p>
</li>
<li>
<p>然后直接运行：<code>htop</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="二-快速部署">二、快速部署</h2>
<ul>
<li>
<p>下载：</p>
<ul>
<li>
<p>Git-HTTPS 方式：<code>git clone https://github.com/bestHAI/gitlab.git</code></p>
</li>
<li>
<p>Git-SSH 方式：<code>git clone git@github.com:bestHAI/gitlab.git</code></p>
</li>
<li>
<p>zip压缩包：<code>wget https://github.com/bestHAI/gitlab/archive/1.0.0.zip</code></p>
</li>
<li>
<p>gz压缩包：<code>wget https://github.com/bestHAI/gitlab/archive/1.0.0.tar.gz</code></p>
</li>
</ul>
</li>
<li>
<p>启动：</p>
<ul>
<li>
<p>先进入上面下载好的gitlab工程目录，如果是压缩包需要自行解压</p>
</li>
<li>
<p><code>chmod +x auto_run.sh &amp;&amp; ./auto_run.sh 【IP】 【域名】 【名称】</code></p>
</li>
</ul>
</li>
<li>
<p>参数：</p>
<ul>
<li>
<p>三个参数，缺一不可，因为都至关重要的</p>
</li>
<li>
<p>IP：服务器的IP地址，这个一定根据实际填</p>
</li>
<li>
<p>域名：部署成功后，用户访问的域名，可自定义</p>
</li>
<li>
<p>名称：可以是公司名称或者单位名称，会在首页上显示</p>
</li>
</ul>
</li>
<li>
<p>命令：</p>
<ul>
<li><code>[ ]</code> 内为变量，请自行更改</li>
</ul>
<pre><code class="language-bash">wget https://github.com/bestHAI/gitlab/archive/1.0.0.tar.gz &amp;&amp; \
tar zxvf 1.0.0.tar.gz &amp;&amp; mv gitlab-1.0.0/ gitlab &amp;&amp; cd gitlab/ &amp;&amp; \
chmod +x auto_run.sh &amp;&amp; ./auto_run.sh [IP] [域名] [名称]
</code></pre>
</li>
</ul>
<h2 id="三-开放的端口">三、开放的端口</h2>
<ul>
<li>
<p><code>22</code>：Gitlab 的 SSH 端口</p>
</li>
<li>
<p><code>80</code>：Gitlab 的 http 默认端口</p>
</li>
<li>
<p><code>443</code>：Gitlab 的 https 默认端口</p>
</li>
<li>
<p><code>9000</code>：portainer 服务端口</p>
</li>
</ul>
<h2 id="四-配置文件">四、配置文件</h2>
<ul>
<li>
<p>以下是几个重要的配置文件的具体路径：</p>
<ul>
<li>
<p><code>./gitlab/config/gitlab.rb</code>：Gitlab 的详细配置文件</p>
</li>
<li>
<p><code>./gitlab-runner/config/config.toml</code>：Gitlab-runner 的配置文件</p>
</li>
<li>
<p><code>./nginx/nginx.conf</code>：Nginx 的配置文件</p>
</li>
</ul>
</li>
</ul>
<h2 id="五-服务架构">五、服务架构</h2>
<figure data-type="image" tabindex="1"><img src="https://besthai.github.io/post-images/1583645349681.png" alt="" loading="lazy"></figure>
<h2 id="六-工程目录结构">六、工程目录结构</h2>
<pre><code class="language-text">   ./--- （工程根目录）
      |
      |--- ca/   (生成和保存SSL证书服务)
      |      |
      |      |--- auto_ca.sh (自动生成自签证书的脚本)
      |
      |--- gitlab/   (gitlab的工作目录)
      |      |
      |      |--- backup/  （备份目录）
      |      |
      |      |--- config/  （配置目录）
      |      |      |
      |      |      |--- gitlab.rb  （当前 gitlab 的配置文件）
      |      |      |
      |      |      |--- gitlab.rb.template  （原版 gitlab 的配置文件模板）
      |      |
      |      |--- data/  （数据目录）
      |      |
      |      |--- logs/  （日志目录）
      |
      |--- gitlab-runner/   (gitlab-runner 的工作目录)
      |      |
      |      |--- ci_example/  （ci 的例子）
      |      |
      |      |--- config/  （配置目录）
      |             |
      |             |--- config.toml  （当前 gitlab-runner 的配置文件）
      |
      |--- images/   (构建一些自定义的docker镜像)
      |      |
      |      |--- docker_ssh/  （可以远程 SSH 登陆的镜像，可以开放给成员作为编译用）
      |      |      |
      |      |      |--- docker_ssh_centos/  （纯 centos 系统）
      |      |      |
      |      |      |--- docker_ssh_centos_python/  （预装python 3.5.3 的 centos 系统）
      |      |      |
      |      |      |--- docker_ssh_ubuntu/  （纯 Ubuntu 系统）
      |      |      |
      |      |      |--- docker_ssh_ubuntu_python/  （预装python 3.5.3 的 Ubuntu 系统）
      |      |
      |      |--- gitlab-runner/  （gitlab-runner所需的镜像）
      |             |
      |             |--- python-ai/  （用于python-ai 的 gitlab-runner 的镜像）
      |             |
      |             |--- python-web/  （用于python-web 的 gitlab-runner 的镜像）
      |
      |--- index/  （网站首页目录，提供导航和帮助）
      |      |
      |      |--- gitlab/  （gitlab 帮助文档）
      |      |
      |      |--- start/  （初次进入网站的导航，进行域名解析配置）
      |
      |--- logs/  （系统日志目录，如：系统初始化、定时备份等日志）
      |
      |--- mail/  （邮件服务的工作目录）
      |
      |--- nginx/  （Nginx 均衡负载和反向代理工作目录）
      |      |
      |      |--- nginx.conf  （nginx 配置文件）
      |
      |--- portainer/  （docker可视化服务的工作目录）
      |
      |--- tools/  （存放一些简化系统运维的管理脚本）
      |
      |--- auto_run.sh  （自动启动服务的脚本）
      |
      |--- code_server_stack.yml （整个系统的 yml 部署文件）

</code></pre>
<h2 id="七-日常维护常用命令">七、日常维护常用命令</h2>
<ul>
<li>
<p>首次启动： <code>chmod +x auto_run.sh &amp;&amp; ./auto_run.sh 【IP】 【域名】 【名称】</code></p>
<ul>
<li>
<p>【IP】：部署服务的 ipv4 地址</p>
</li>
<li>
<p>【域名】：服务启动后，通过该域名来访问的，可以按需要来取，但必须符合 <strong>域名</strong> 的命名规则（如：myserver.com，最好都用纯英文小写字母，中间不要有其他符号和空格）</p>
</li>
<li>
<p>【名称】：服务器的名称，这个可以根据需要取，中英文均可</p>
</li>
</ul>
</li>
<li>
<p>非初次启动命令： <code>./auto_run.sh</code></p>
<ul>
<li>因为系统比较大，启动服务也较多，会花大概5到10分钟启动</li>
</ul>
</li>
<li>
<p>停止</p>
<ul>
<li>
<p>进入存放管理脚本的目录：<code>cd tools/</code></p>
</li>
<li>
<p>停止脚本：<code>./down.sh</code></p>
</li>
<li>
<p>再次启动：<code>./up.sh</code></p>
</li>
</ul>
</li>
<li>
<p>监控</p>
<ul>
<li>
<p>进入存放管理脚本的目录：<code>cd tools/</code></p>
</li>
<li>
<p>整体情况：<code>./ps.sh</code></p>
</li>
<li>
<p>单个日志：<code>./log 【容器名称】</code></p>
</li>
<li>
<p>【容器名称】有：nginx、gitlab-ce、gitlab-runner、mail、portainer</p>
</li>
</ul>
</li>
<li>
<p>管理</p>
<ul>
<li>
<p>进入存放管理脚本的目录：<code>cd tools/</code></p>
</li>
<li>
<p>进入容器脚本：<code>./exec.sh 【容器名称】 【可选命令】</code></p>
</li>
<li>
<p>【容器名称】有：nginx、gitlab-ce、gitlab-runner、mail、portainer</p>
</li>
<li>
<p>【可选命令】：（1）当该参数为空时，会直接进入对应的容器。（2）当该参数不为空时，只返回执行的结果，而不会进入容器内部。</p>
</li>
</ul>
</li>
</ul>
<h2 id="八-更多帮助">八、更多帮助</h2>
<ul>
<li><a href="https://github.com/bestHAI/gitlab/wiki">Wiki文档</a></li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E3%80%87-%E7%AE%80%E4%BB%8B">〇、简介</a></li>
<li><a href="#%E4%B8%80-%E9%83%A8%E7%BD%B2%E8%A6%81%E6%B1%82">一、部署要求</a></li>
<li><a href="#%E4%BA%8C-%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2">二、快速部署</a></li>
<li><a href="#%E4%B8%89-%E5%BC%80%E6%94%BE%E7%9A%84%E7%AB%AF%E5%8F%A3">三、开放的端口</a></li>
<li><a href="#%E5%9B%9B-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">四、配置文件</a></li>
<li><a href="#%E4%BA%94-%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84">五、服务架构</a></li>
<li><a href="#%E5%85%AD-%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">六、工程目录结构</a></li>
<li><a href="#%E4%B8%83-%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">七、日常维护常用命令</a></li>
<li><a href="#%E5%85%AB-%E6%9B%B4%E5%A4%9A%E5%B8%AE%E5%8A%A9">八、更多帮助</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://besthai.github.io/post/shadowsocks_in_docker/">
              <h3 class="post-title">
                Docker 快速部署 ShadowSocks 服务
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '33a8894d857d8ad06c03',
    clientSecret: '0a6db4461c241c7ffd9160f98655f01c626c50fa',
    repo: 'bestHAI.github.io',
    owner: 'bestHAI',
    admin: ['bestHAI'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  <p class="published border-effect">Copyright &copy; HAI</p>
  <a class="rss" href="https://besthai.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
